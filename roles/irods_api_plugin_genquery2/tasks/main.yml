---
# copyright Utrecht University

- name: Include OS-specific variables
  ansible.builtin.include_vars: "{{ ansible_os_family }}.yml"


- name: Install iRODS API plugin GenQuery2 (EL)
  ansible.builtin.import_tasks: install-redhat.yml
  when: ansible_os_family == 'RedHat'


- name: Install iRODS API plugin GenQuery2 (Ubuntu)
  ansible.builtin.import_tasks: install-ubuntu.yml
  when: ansible_os_family == 'Debian'


- name: Ensure iRODS API plugin GenQuery2 is configured
  become_user: '{{ irods_service_account }}'
  become: true
  # noqa fqcn[action]
  irods_genquery2:
    config_path: '/etc/irods/server_config.json'
  notify: Restart iRODS
  when: not ansible_check_mode


- name: Ensure jq is installed
  ansible.builtin.package:
    name: jq
    state: present
