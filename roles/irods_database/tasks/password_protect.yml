---
# copyright Utrecht University

- name: Resolve iCAT host
  # noqa fqcn[action]
  resolve:
    host: "{{ icat_host }}"
  register: icat_resolved


- name: Password protect iCAT connections
  ansible.builtin.lineinfile:
    dest: '{{ "/var/lib/pgsql/data" if postgresql_use_native_packages else postgresql_config_path }}/pg_hba.conf'
    line: "host all all {{ icat_resolved['ip'] }}/32 md5"
  notify: Restart PostgreSQL
  when: not postgresql_use_native_packages
