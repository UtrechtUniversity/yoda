---
# copyright Utrecht University

- name: Ensure iRODS consistency check virtualenv exists
  become_user: '{{ irods_service_account }}'
  become: true
  ansible.builtin.command: /usr/local/bin/python3 -m virtualenv "/var/lib/irods/irods-consistency-check"
  args:
    creates: /var/lib/irods/irods-consistency-check


- name: Ensure iRODS consistency check is installed
  become_user: '{{ irods_service_account }}'
  become: true
  ansible.builtin.pip:
    name: "git+https://github.com/UtrechtUniversity/irods-consistency-check.git@v{{ irods_consistency_check_version }}"
    virtualenv: '/var/lib/irods/irods-consistency-check'
    virtualenv_python: python3
