<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>To vault process in research module - Yoda</title> <link rel="shortcut icon" href="/yoda/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/yoda/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/yoda/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/yoda/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>To vault process in research module | Yoda</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="To vault process in research module" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="On this website you can find release notes and technical documentation on software design and administration tasks of Yoda" /> <meta property="og:description" content="On this website you can find release notes and technical documentation on software design and administration tasks of Yoda" /> <meta property="og:site_name" content="Yoda" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="To vault process in research module" /> <script type="application/ld+json"> {"description":"On this website you can find release notes and technical documentation on software design and administration tasks of Yoda","headline":"To vault process in research module","@type":"WebPage","url":"/yoda/design/processes/vault-process.html","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/yoda/yoda.svg"}},"@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/yoda/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/yoda/" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/yoda/release-notes/" class="nav-list-link">Release Notes</a><ul class="nav-list "><li class="nav-list-item "><a href="/yoda/release-notes/release-1.8.html" class="nav-list-link">v1.8</a></li><li class="nav-list-item "><a href="/yoda/release-notes/release-1.7.html" class="nav-list-link">v1.7</a></li><li class="nav-list-item "><a href="/yoda/release-notes/release-1.6.html" class="nav-list-link">v1.6</a></li><li class="nav-list-item "><a href="/yoda/release-notes/release-1.5.html" class="nav-list-link">v1.5</a></li><li class="nav-list-item "><a href="/yoda/release-notes/release-1.4.html" class="nav-list-link">v1.4</a></li><li class="nav-list-item "><a href="/yoda/release-notes/release-1.3.html" class="nav-list-link">v1.3</a></li><li class="nav-list-item "><a href="/yoda/release-notes/release-1.2.html" class="nav-list-link">v1.2</a></li><li class="nav-list-item "><a href="/yoda/release-notes/release-1.1.html" class="nav-list-link">v1.1</a></li><li class="nav-list-item "><a href="/yoda/release-notes/release-1.0.html" class="nav-list-link">v1.0</a></li><li class="nav-list-item "><a href="/yoda/release-notes/release-0.9.7.html" class="nav-list-link">v0.9.7</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/yoda/design/" class="nav-list-link">Software Design</a><ul class="nav-list "><li class="nav-list-item "><a href="/yoda/design/api/" class="nav-list-link">API</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/yoda/design/overview/" class="nav-list-link">System Overview</a><ul class="nav-list"><li class="nav-list-item "> <a href="/yoda/design/overview/research-space.html" class="nav-list-link">Research space</a> </li><li class="nav-list-item "> <a href="/yoda/design/overview/vault-space.html" class="nav-list-link">Vault space</a> </li><li class="nav-list-item "> <a href="/yoda/design/overview/group-manager.html" class="nav-list-link">Group manager</a> </li><li class="nav-list-item "> <a href="/yoda/design/overview/statistics.html" class="nav-list-link">Statistics module</a> </li><li class="nav-list-item "> <a href="/yoda/design/overview/deposit-space.html" class="nav-list-link">Deposit space</a> </li><li class="nav-list-item "> <a href="/yoda/design/overview/theme-packages.html" class="nav-list-link">Theme packaging</a> </li><li class="nav-list-item "> <a href="/yoda/design/overview/intake.html" class="nav-list-link">Intake module</a> </li><li class="nav-list-item "> <a href="/yoda/design/overview/data-requests.html" class="nav-list-link">Data requests module</a> </li><li class="nav-list-item "> <a href="/yoda/design/overview/authentication.html" class="nav-list-link">Authentication</a> </li><li class="nav-list-item "> <a href="/yoda/design/overview/data_package_reference.html" class="nav-list-link">Data Package Reference</a> </li><li class="nav-list-item "> <a href="/yoda/design/overview/deployment.html" class="nav-list-link">Deployment</a> </li><li class="nav-list-item "> <a href="/yoda/design/overview/external-user-service.html" class="nav-list-link">External User Service</a> </li><li class="nav-list-item "> <a href="/yoda/design/overview/yoda-moai.html" class="nav-list-link">Yoda MOAI service</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/yoda/design/metadata/" class="nav-list-link">Metadata</a><ul class="nav-list"><li class="nav-list-item "> <a href="/yoda/design/metadata/metadata-form-json.html" class="nav-list-link">Metadata JSON schema</a> </li><li class="nav-list-item "> <a href="/yoda/design/metadata/metadata-form.html" class="nav-list-link">Metadata form</a> </li><li class="nav-list-item "> <a href="/yoda/design/metadata/metadata-import-export-technical.html" class="nav-list-link">Metadata import and export</a> </li><li class="nav-list-item "> <a href="/yoda/design/metadata/metadata-mappings.html" class="nav-list-link">Metadata mappings</a> </li><li class="nav-list-item "> <a href="/yoda/design/metadata/metadata-schema-identifier.html" class="nav-list-link">Metadata schema identifier</a> </li><li class="nav-list-item "> <a href="/yoda/design/metadata/metadata-schemas.html" class="nav-list-link">Metadata schemas</a> </li><li class="nav-list-item "> <a href="/yoda/design/metadata/metadata-transformation.html" class="nav-list-link">Metadata transformations</a> </li><li class="nav-list-item "> <a href="/yoda/design/metadata/metadata-vault.html" class="nav-list-link">Metadata vault</a> </li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/yoda/design/processes/" class="nav-list-link">Processes</a><ul class="nav-list"><li class="nav-list-item "> <a href="/yoda/design/processes/async-system-execution.html" class="nav-list-link">Asynchronous and Privileged Execution</a> </li><li class="nav-list-item "> <a href="/yoda/design/processes/asynchronous-processes.html" class="nav-list-link">Asynchronous processes</a> </li><li class="nav-list-item "> <a href="/yoda/design/processes/locking-mechanism.html" class="nav-list-link">Folder Locking mechanism</a> </li><li class="nav-list-item "> <a href="/yoda/design/processes/publication-process.html" class="nav-list-link">Publication Process</a> </li><li class="nav-list-item "> <a href="/yoda/design/processes/revisions.html" class="nav-list-link">Revision management</a> </li><li class="nav-list-item active"> <a href="/yoda/design/processes/vault-process.html" class="nav-list-link active">To vault process in research module</a> </li></ul></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/yoda/administration/" class="nav-list-link">Administration Tasks</a><ul class="nav-list "><li class="nav-list-item "><a href="/yoda/administration/configuring-yoda.html" class="nav-list-link">Configuring Yoda</a></li><li class="nav-list-item "><a href="/yoda/administration/deploying-yoda.html" class="nav-list-link">Deploying Yoda</a></li><li class="nav-list-item "><a href="/yoda/administration/hotfixing-ruleset.html" class="nav-list-link">Hotfixing ruleset</a></li><li class="nav-list-item "><a href="/yoda/administration/local-ruleset-patch.html" class="nav-list-link">Local ruleset patches</a></li><li class="nav-list-item "><a href="/yoda/administration/installing-licenses.html" class="nav-list-link">Installing Licenses</a></li><li class="nav-list-item "><a href="/yoda/administration/installing-terms.html" class="nav-list-link">Installing Terms & Conditions</a></li><li class="nav-list-item "><a href="/yoda/administration/installing-preservable-file-formats.html" class="nav-list-link">Installing lists of preservable file formats</a></li><li class="nav-list-item "><a href="/yoda/administration/installing-metadata-schemas.html" class="nav-list-link">Installing metadata schemas</a></li><li class="nav-list-item "><a href="/yoda/administration/installing-datarequest-module.html" class="nav-list-link">Installing datarequest module</a></li><li class="nav-list-item "><a href="/yoda/administration/upgrading-metadata-schemas.html" class="nav-list-link">Upgrading metadata schemas</a></li><li class="nav-list-item "><a href="/yoda/administration/troubleshooting-publication.html" class="nav-list-link">Troubleshooting publication</a></li><li class="nav-list-item "><a href="/yoda/administration/troubleshooting-email.html" class="nav-list-link">Troubleshooting email</a></li><li class="nav-list-item "><a href="/yoda/administration/configuring-openidc.html" class="nav-list-link">Configuring OIDC</a></li><li class="nav-list-item "><a href="/yoda/administration/troubleshooting-replication-revisions.html" class="nav-list-link">Troubleshooting replication and revision creation</a></li><li class="nav-list-item "><a href="/yoda/administration/configuring-data-access-passwords.html" class="nav-list-link">Configuring Data Access Passwords</a></li><li class="nav-list-item "><a href="/yoda/administration/restore-collection.html" class="nav-list-link">Restore collection</a></li><li class="nav-list-item "><a href="/yoda/administration/setting-job-flags.html" class="nav-list-link">Setting job flags</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/yoda/development/" class="nav-list-link">Development</a><ul class="nav-list "><li class="nav-list-item "><a href="/yoda/development/setting-up-development-environment.html" class="nav-list-link">Setting up development environment</a></li><li class="nav-list-item "><a href="/yoda/development/development-tips.html" class="nav-list-link">Development tips</a></li><li class="nav-list-item "><a href="/yoda/development/wall-of-fame.html" class="nav-list-link">Wall of Fame</a></li><li class="nav-list-item "><a href="/yoda/development/yodadrive-development-environment.html" class="nav-list-link">Setting up YodaDrive development environment</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Yoda" aria-label="Search Yoda" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://github.com/UtrechtUniversity/yoda" class="site-button" > Yoda on GitHub </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/yoda/design/">Software Design</a></li> <li class="breadcrumb-nav-list-item"><a href="/yoda/design/processes/">Processes</a></li> <li class="breadcrumb-nav-list-item"><span>To vault process in research module</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="to-vault-process-in-research-module"> <a href="#to-vault-process-in-research-module" class="anchor-heading" aria-labelledby="to-vault-process-in-research-module"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> To vault process in research module </h1> <p>This document does not fully describe the process to push datapackages to the vault. Only the technical choices made to implement the process are described here. The process is described in the architectural state model.</p> <h2 id="folder-status"> <a href="#folder-status" class="anchor-heading" aria-labelledby="folder-status"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Folder status </h2> <p>Each folder in the research area is initialized without any status information. This is regarded as the folder status <em>Folder</em>. Every other status is defined by the metadata field <em>org_status</em> on the collection. The valid statuses and transitions are defined in iiConstant like below.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># \brief All research folder states.
FOLDER = "";
LOCKED = "LOCKED";
SUBMITTED = "SUBMITTED";
ACCEPTED = "ACCEPTED";
REJECTED = "REJECTED";
SECURED = "SECURED";

# \constant IIFOLDERTRANSITIONS
IIFOLDERTRANSITIONS = list((FOLDER, LOCKED),
			   (FOLDER, SUBMITTED),
			   (LOCKED, FOLDER),
			   (LOCKED, SUBMITTED),
			   (SUBMITTED, FOLDER),
			   (SUBMITTED, ACCEPTED),
			   (SUBMITTED, REJECTED),
			   (REJECTED, LOCKED),
			   (REJECTED, FOLDER),
			   (REJECTED, SUBMITTED),
			   (ACCEPTED, SECURED),
			   (SECURED, LOCKED),
			   (SECURED, FOLDER),
			   (SECURED, SUBMITTED))
</code></pre></div></div> <h2 id="status-policies"> <a href="#status-policies" class="anchor-heading" aria-labelledby="status-policies"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Status Policies </h2> <p>All the status transitions are handled by rules in <em>iiFolderStatusTransistions.r</em>. Basically they set the org_status of the folder to the new status and PEP’s in <em>iiPolicies.r</em> will check if the transition is legal and call pre and post procedures for each transition. The checks if a status transition is allowed are found in <em>iiPolicyChecks.r</em>.</p> <p>The pre and post conditions are run based on the manipulation of the <em>org_status</em> metadata. This means every status transition can be triggered with the <em>imeta</em> command. Illegal transitions will be blocked with <em>msiOprDisallowed</em>.</p> <h2 id="datamanager-approval"> <a href="#datamanager-approval" class="anchor-heading" aria-labelledby="datamanager-approval"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Datamanager approval </h2> <p>When a datamanager is present, a datapackage submitted to the vault by a researcher will remain in the submitted state. The datamanager can approve or reject the package for further processing. A researcher also has the opportunity to unsubmit the package. Because a datamanager only has read access to the research area, he/she cannot edit the <em>org_status</em> directly. To work around this issue the sudo microservices are used to temporarily enable the datamanager to set the <em>org_status</em> to ‘ACCEPTED’ or ‘REJECTED’. The rules can be found in <em>iiDatamanagerPolicies.r</em> and <em>iiSudoPolicies.r</em>.</p> <p>A research group without a datamanager can submit packages to the vault directly. Any submitted folder will be transitioned to ‘ACCEPTED’ state immediately after submission.</p> <h2 id="copy-to-vault"> <a href="#copy-to-vault" class="anchor-heading" aria-labelledby="copy-to-vault"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Copy to vault </h2> <p>The <strong>copy-accepted-folders-to-vault.r</strong> cronjob in the tools directory of the research ruleset will copy any folder in ‘ACCEPTED’ state to the vault and set it to ‘SECURED’ state when successful. The copy is done recursively using the uuTreeWalk rule starting from the the ‘ACCEPTED’ folder. The metadata will be copied as well.</p> <h2 id="research-vault"> <a href="#research-vault" class="anchor-heading" aria-labelledby="research-vault"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Research vault </h2> <p>For each research group a vault group with a vault collection is created. Only the rodsadmin will be a member. This folder is read-only for managers and normal users of the research group. When a datamanager group for the category is present it will get read-only access as well. Inheritance is switched off. This makes it possible to manage permissions for each vault package separately. A datamanager gets control over it.</p> <h2 id="granting-and-revoking-read-access-to-the-vault-for-the-research-group"> <a href="#granting-and-revoking-read-access-to-the-vault-for-the-research-group" class="anchor-heading" aria-labelledby="granting-and-revoking-read-access-to-the-vault-for-the-research-group"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Granting and revoking read access to the vault for the research group </h2> <p>The datamanager is allowed to use the sudo microservice msiSudoObjAclSet to grant and revoke read access to packages in the vault. This is configured in <em>iiSudoPolicies.r</em> and <em>iiDatamanagerPolicies.r</em> to not interfere with existing sudo policies in the yoda-ruleset. The only action the datamanager is allowed to do is set permissions starting from the root of a vault package to read for the research group with the same basename as the vault.</p> <h2 id="no-datamanager"> <a href="#no-datamanager" class="anchor-heading" aria-labelledby="no-datamanager"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> No datamanager </h2> <p>When there is no datamanager is present the permissions can only be managed by the rodsadmin. Read-only for the research group by default could be implemented.</p> <hr> <footer> <p class="text-small text-grey-dk-100 mb-0">Copyright &copy; 2017-2021 <a href="https://www.uu.nl/">Utrecht University</a>. Licensed under <a href="https://github.com/UtrechtUniversity/yoda/blob/development/LICENSE">GPLv3</a>.</p> <div class="d-flex mt-2"> <p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/UtrechtUniversity/yoda/tree/development/docs/design/processes/vault-process.md" id="edit-this-page">Edit this page on GitHub.</a> </p> </div> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
