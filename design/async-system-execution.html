<!DOCTYPE html>
<html lang="en">
    <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <link rel="icon" href="/yoda/assets/images/favicon.ico">

  <title>Asynchronous and Privileged Execution</title>

  <link rel='stylesheet' id='bootstrap-css'  href='//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css' type='text/css' media='all' />
  <link rel="stylesheet" href="/yoda/assets/css/style.css" type="text/css" media="screen" />
  <link rel="stylesheet" href="/yoda/assets/css/custom.css" type="text/css" media="screen" />
  <link rel="stylesheet" href="/yoda/assets/css/print.css" type="text/css" media="print" />
</head>

    <body data-rsssl="1" class="page-template-default page page-id-6 page-parent" data-spy="scroll" data-target="#sidebarnav">
        <div id="page">

            <div id="brandbar" class="affix-top">
    <div class="container">
        <div class="row">
            <div class="col-sm-4 col-xs-8 logodiv">
                <button type="button" class="navbar-toggle hidden-print" data-toggle="collapse" data-target="#main-menu-collapse">
                    <span class="sr-only">Navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a href="https://www.uu.nl/en">
                    <img src="/yoda/assets/images/uu-logo.svg" alt="Logo Utrecht University">
                </a>

                <div class="visible-print-block">
                    <h1>YODA</h1>
                </div>
            </div>

            <div class="col-sm-6 col-xs-4 hidden-print" role="search">
                <!--
                <div class="pull-right">
                    <form method="get" id="searchform" action="https://yoda.sites.uu.nl">
                        <div class="search-wrapper">
                            <label class="screen-reader-text" for="s">'</label>
                            <input type="text" class="searchfield" value="" name="s" id="s" placeholder="Search the Site...">
                            <input type="submit" id="searchsubmit" class="searchbutton" value="">
                        </div>
                    </form>
                </div>
                -->
            </div>
        </div>
    </div>
</div>
<header id="masthead" class="header hidden-print">
    <div class="container">
        <h1>
            <a href="/yoda" rel="home" title="YODA">
                YODA
            </a>
        </h1>
    </div>
</header>

<a class="skip-link sr-only" href="#content">Skip to content</a>

<!-- MAIN MENU -->
<nav id="#access" class="navbar navbar-default navbar-inverse">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="container">
        <div class="navbar-header"></div>
        <div id="main-menu-collapse" class="collapse navbar-collapse">
            <ul id="menu-hoofdmenu" class="nav navbar-nav">
                
                <li class="first-item menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                    
                    <a title="Release notes" href="/yoda/release-notes/index.html">Release notes</a>
                    
                </li>
                
                <li class="first-item menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                    
                    <a title="Administration" href="/yoda/administration/index.html">Administration</a>
                    
                </li>
                
                <li class="first-item menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                    
                    <a title="Development" href="/yoda/development/index.html">Development</a>
                    
                </li>
                
                <li class="first-item menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                    
                    <a title="Software design" href="/yoda/design/index.html">Software design</a>
                    
                </li>
                
            </ul>
        </div>
    </div>
</nav>
<!-- /MAIN MENU -->


            <div id="content" class="two-col">
                <header class="article-header article-header-main">
                    <div class="header-image hidden-print">

                        
                        <div class="breadcrumbs" xmlns:v="https://rdf.data-vocabulary.org/#">
                            <div class="container">
							<span property="itemListElement" typeof="ListItem">
								<span property="name">YODA</span>
								<meta property="position" content="1">
							</span>
                            </div>
                        </div>
                        

                        <img src="/yoda/assets/images/header.jpg" alt="">

                        
                        <div class="page-header-placeholder"></div>
                        
                    </div>
                </header>

                <div id="content-wrapper" class="container">
                    <div class="row-offcanvas row-offcanvas-left">
                        <div id="left-sidebar" class="sidebar-offcanvas clearfix hidden-print" role="complementary">
                            <!-- PAGE MENU -->
                            
                            
                            
                            <div class="widget-1 first-widget widget widget_nav_menu">
                                <h4 class="widgettitle">Menu</h4>
                                <div class="menu-hoofdmenu-container">
                                    <!-- PAGE MENU -->
                                    <ul class="menu">
                                        
                                        
                                            
                                            <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                                                <a href="/yoda/design/system-overview.html">System overview</a>
                                            </li>
                                        
                                            
                                            <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                                                <a href="/yoda/design/state-model.html">State model</a>
                                            </li>
                                        
                                            
                                            <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children current-menu-item">
                                                <a href="/yoda/design/async-system-execution.html">Asynchronous and privileged execution</a>
                                            </li>
                                        
                                            
                                            <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                                                <a href="/yoda/design/external-user-service.html">External user service</a>
                                            </li>
                                        
                                            
                                            <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                                                <a href="/yoda/design/group-manager.html">Group manager</a>
                                            </li>
                                        
                                            
                                            <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                                                <a href="/yoda/design/locking-mechanism.html">Locking mechanism</a>
                                            </li>
                                        
                                            
                                            <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                                                <a href="/yoda/design/metadata-form.html">Metadata form</a>
                                            </li>
                                        
                                            
                                            <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                                                <a href="/yoda/design/publication-process.html">Publication process</a>
                                            </li>
                                        
                                            
                                            <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                                                <a href="/yoda/design/python-plugin.html">Python plugin</a>
                                            </li>
                                        
                                            
                                            <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                                                <a href="/yoda/design/statistics.html">Statistics module</a>
                                            </li>
                                        
                                            
                                            <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                                                <a href="/yoda/design/revisions.html">Revision management</a>
                                            </li>
                                        
                                            
                                            <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                                                <a href="/yoda/design/vault-process.html">Vault process</a>
                                            </li>
                                        
                                    </ul>
                                </div>
                            </div>
                            
                            <!-- /PAGE MENU -->    
                        </div>

                        <div class="page-content clearfix">
                            
                            <div class="page-title">
                                <h1>
                                    Asynchronous and Privileged Execution
                                </h1>
                            </div>
                            
			    <!--
                            <div class="toggle-btn-div visible-xs clearfix">
                                <button type="button" class="toggle-btn white button icon left arrow-right" data-toggle="offcanvas">
                                    Show sidebar
                                </button>
                            </div>
                            -->
                            <div class="page-content-inner facetwp-template">

                                <article id="post-6" class="clearfix post-6 page type-page status-publish hentry first-post">
                                    <section class="entry-content">
                                        <h1 id="asynchronous-and-privileged-execution">Asynchronous and Privileged Execution</h1>

<p>Yoda uses delayed- and remote rule execution.
There are different reasons to apply these constructs, and different ways to use these.
Currently there is a bug in iRods whereby output parameters are not passed to delayed- or remote rules.
This document explains where and how these constructs are applied.</p>

<h2 id="concerns">Concerns</h2>
<p>The following concerns need to be dealt with:</p>
<ol>
  <li>Security: we must protect the integrity/availability of data in the vault.</li>
  <li>Interactivity: the interactive user should not wait for tasks.</li>
  <li>Scalability: tasks with long execution time should not block other processes.</li>
  <li>Tracability: it should be tracable who was responsible for certain changes.</li>
</ol>

<p>To address these concerns, we made the following decisions:</p>

<ul>
  <li>
    <p><strong>Decision: asynchronous execution of tasks with long- or uncertain execution time</strong>.  Tasks that require long (say: more than 2 sec) or uncertain execution must be executed asynchronous from the interactive session.<br />
<strong>Rationale</strong>: this allows the interactive session to continue (Concern 2), and these jobs to be scheduled/prioritized (Concern 3).<br />
<strong>Impact</strong>: The interactive user is not informed of the result of the task, but that the task is pending. The user should be informed of the end-result via alternative channels.</p>
  </li>
  <li>
    <p><strong>Decision: exclusive privileges for vault</strong>. Tasks in the vault require exclusive privileges. These privileges may only be assigned to actors that can be trusted. <br />
<strong>Rationale</strong>: Data in the vault must be protected from undesired changes that may damage the integrity/authenticity that is required for reuse of the data (Concern 1).<br />
<strong>Impact</strong>: Privileges may not be assigned to an interactive user, as credentials may be compromised and to prevent human errors. Privileges must be limited to defined procedures that can be trusted to maintain integrity/authenticity. The system must register who ordered such a procedure (Concern 4).</p>
  </li>
</ul>

<h2 id="solutions">Solutions</h2>

<p>We identified the following constructs to provide privileged and/or asynchronous execution:</p>

<ol>
  <li>ExecCmd-of-irule for privileged execution.</li>
  <li>Delayed Rule for asynchronous execution. Currently this does not work in all cases, due to a bug with for delayed rules with output parameters in the top-level call.</li>
  <li>Cronjob for asynchronous AND privileged execution. This allows a job to be ‘picked up’ and executed within the system environment. Drawback: asynchronous, cronjobs can only be scheduled at minute-granularity, so certain jobs require ~1m to start.  We use cronjobs as a fallback when we cannot use delayed rules due to a bug in irods.</li>
</ol>

<p>The table below describes the ideal application of the above constructs. For now, the the cronjob is sometimes used for all async executions (bottom line).</p>

<table>
  <thead>
    <tr>
      <th> </th>
      <th><strong>User Environment</strong></th>
      <th><strong>System Environment</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Synchronous</strong></td>
      <td>Default</td>
      <td>Use ExecCmd</td>
    </tr>
    <tr>
      <td><strong>ASynchronous</strong></td>
      <td>Delayed Rule</td>
      <td>Delayed Rule + ExecCmd</td>
    </tr>
  </tbody>
</table>

<h2 id="further-work">Further Work</h2>

<ul>
  <li>Discuss the motivation for using the system/iRods user to increase privileges. Should we ideally use a specific user/role with specific privileges for the vault?</li>
  <li>Discuss how the state model is reflected in the publication space.</li>
  <li>Discuss applying ‘pending’ states to the toVault as well, in line with the pending states for publication.</li>
  <li>Deletion of Data Package from the vault not yet implemented.</li>
  <li>Create state model for revisions and replications.</li>
  <li>Create state model for updating metadata.</li>
</ul>

<h2 id="appendix-overview-of-rules-and-solutions">Appendix: Overview of rules and solutions</h2>

<p>The image below shows the state model, and indicates the actions that require asynchronous execution and/or privileges. The table below described the individual actions.
<img src="/yoda/design/img/ExecutionInStateModel.png" alt="Actions in State Model" /></p>

<table>
  <thead>
    <tr>
      <th>#</th>
      <th>Action</th>
      <th>(a)sync</th>
      <th>Context</th>
      <th>State Change</th>
      <th>Comment</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1a</td>
      <td>Research2Vault (request)</td>
      <td>sync</td>
      <td>user</td>
      <td> </td>
      <td>Register Action and request execution</td>
    </tr>
    <tr>
      <td>1b</td>
      <td>Research2Vault (execution)</td>
      <td><strong>async</strong></td>
      <td><strong>system</strong></td>
      <td>ACCEPTED - SECURED<br />New object: UNPUBLISHED</td>
      <td>Copy files</td>
    </tr>
    <tr>
      <td>2a</td>
      <td>Vault2Research (request)</td>
      <td>sync</td>
      <td>user</td>
      <td> </td>
      <td>Register action and request execution</td>
    </tr>
    <tr>
      <td>2b</td>
      <td>Vault2Research (execution)</td>
      <td><strong>async</strong></td>
      <td>user</td>
      <td>New object: LOCKED</td>
      <td>Copy files</td>
    </tr>
    <tr>
      <td>3a</td>
      <td>SubmitPublication (request)</td>
      <td>sync</td>
      <td>user</td>
      <td> </td>
      <td>Register action  and request execution</td>
    </tr>
    <tr>
      <td>3b</td>
      <td>SubmitPublication (execution)</td>
      <td>sync</td>
      <td><strong>system</strong></td>
      <td>UNPUBLISHED - SUBMITTED_FOR_PUBLICATION</td>
      <td> </td>
    </tr>
    <tr>
      <td>4a</td>
      <td>ApprovePublication (request)</td>
      <td>sync</td>
      <td>user</td>
      <td> </td>
      <td>Register action ande request execution</td>
    </tr>
    <tr>
      <td>4b</td>
      <td>ApprovePublication (execution)</td>
      <td>sync</td>
      <td><strong>system</strong></td>
      <td>SUBMITTED_FOR_PUBLICATION - APPROVED_FOR_PUBLICATION</td>
      <td>trigger Publish</td>
    </tr>
    <tr>
      <td>5</td>
      <td>Publish</td>
      <td><strong>async</strong></td>
      <td><strong>system</strong></td>
      <td>APPROVED_FOR_PUBLICATION - PUBLISHED</td>
      <td>Create/Register DOI, PMH, etc.<br /><em>there is no registered within for public area?!</em></td>
    </tr>
    <tr>
      <td>6a</td>
      <td>RejectPublication (request)</td>
      <td>sync</td>
      <td>user</td>
      <td> </td>
      <td>Register action and request execution</td>
    </tr>
    <tr>
      <td>6b</td>
      <td>RejectPublication (execution)</td>
      <td>sync</td>
      <td><strong>system</strong></td>
      <td>SUBMITTED_FOR_PUBLICATION - UNPUBLISHED</td>
      <td><em>(is nog async, kan tzt sync worden)</em></td>
    </tr>
    <tr>
      <td>7a</td>
      <td>Published2pending (request)</td>
      <td>sync</td>
      <td>user</td>
      <td> </td>
      <td>Register action and request execution</td>
    </tr>
    <tr>
      <td>7b</td>
      <td>Published2pending (execute)</td>
      <td>sync</td>
      <td><strong>system</strong></td>
      <td>PUBLISHED - PENDING_DEPUBLICATION</td>
      <td> </td>
    </tr>
    <tr>
      <td>7c</td>
      <td>Pending2depublished</td>
      <td><strong>async</strong></td>
      <td><strong>system</strong></td>
      <td>PENDING_DEPUBLICATION - DEPUBLISHED</td>
      <td>Update/register DOI, PMH, etc.</td>
    </tr>
    <tr>
      <td>8a</td>
      <td>Republish2pending (requestt)</td>
      <td>sync</td>
      <td>user</td>
      <td> </td>
      <td>Register action and request execution</td>
    </tr>
    <tr>
      <td>8b</td>
      <td>Republish2pending (execution)</td>
      <td>sync</td>
      <td><strong>system</strong></td>
      <td>DEPUBLISHED - PENDING_REPUBLICATION</td>
      <td>trigger pending2published</td>
    </tr>
    <tr>
      <td>8c</td>
      <td>Pending2published</td>
      <td><strong>async</strong></td>
      <td><strong>system</strong></td>
      <td>PENDING_REPUBLICATION - PUBLISHED</td>
      <td>Update/register DOI, PMH, etc.,</td>
    </tr>
    <tr>
      <td>9</td>
      <td>Revisioning</td>
      <td><strong>async</strong></td>
      <td>user</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>10</td>
      <td>Replication</td>
      <td><strong>async</strong></td>
      <td>user</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>11a</td>
      <td>Update Vault Metadata (request)</td>
      <td>sync</td>
      <td>user</td>
      <td> </td>
      <td>Register action and request execution</td>
    </tr>
    <tr>
      <td>11b</td>
      <td>Update Vault Metadata (execution)</td>
      <td>sync</td>
      <td><strong>system</strong></td>
      <td> </td>
      <td>Create metadata updates and trigger publication actions</td>
    </tr>
    <tr>
      <td>11c</td>
      <td>Update Vault Metadata (publishing)</td>
      <td><strong>async</strong></td>
      <td><strong>system</strong></td>
      <td> </td>
      <td>Update/register DOI, PMH, etc.</td>
    </tr>
  </tbody>
</table>

<p>Note that all  actions that require async/system execution are preceded by a synchronous user action that registers the action, and triggers the async/system action: 1, 2, 3, 4, , 6, 7, 8.</p>

<p>Actions are registered (in principle) in iCat, in provenance (user actions) and in system log.
Registration in system log not always consequently.</p>

                                    </section>

                                    <footer class="article-footer"></footer>
                                </article>
                            </div> <!-- /page-content-inner -->
                        </div> <!-- /page-content -->
                    </div> <!--row-offcanvas -->
                </div> <!-- /#content-wrapper -->
            </div>

            <footer id="colophon" class="footer hidden-print">
                <div id="inner-footer" class="container clearfix">
                    <div class="row">
                        <div class="col-sm-6">
                            <img alt="Logo Utrecht University" src="/yoda/assets/images/uu-logo-footer.svg">
                        </div>
                        <div class="col-sm-6">
                            <p class="source-org copyright pull-right">© 2019 Utrecht University, <a href="https://www.uu.nl/en/organisation/contact/disclaimer">disclaimer</a></p>
                        </div>
                    </div>
                </div>
            </footer>

            <p id="back-top" style="display: none;">
                <a href="#top"><i class="fa fa-angle-up"></i></a>
            </p>

            <script type="text/javascript" src='/yoda/assets/js/jquery.js'></script>
<script type="text/javascript" src='/yoda/assets/js/bootstrap.min.js'></script>
        </div>
    </body>
</html>
