<!DOCTYPE html>
<html lang="en">
    <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <link rel="icon" href="/yoda/assets/images/favicon.ico">

  <title>To vault process in research module</title>

  <link rel='stylesheet' id='bootstrap-css'  href='//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css' type='text/css' media='all' />
  <link rel="stylesheet" href="/yoda/assets/css/style.css" type="text/css" media="screen" />
  <link rel="stylesheet" href="/yoda/assets/css/custom.css" type="text/css" media="screen" />
  <link rel="stylesheet" href="/yoda/assets/css/print.css" type="text/css" media="print" />
</head>

    <body data-rsssl="1" class="page-template-default page page-id-6 page-parent" data-spy="scroll" data-target="#sidebarnav">
        <div id="page">

            <div id="brandbar" class="affix-top">
    <div class="container">
        <div class="row">
            <div class="col-sm-4 col-xs-8 logodiv">
                <button type="button" class="navbar-toggle hidden-print" data-toggle="collapse" data-target="#main-menu-collapse">
                    <span class="sr-only">Navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a href="https://www.uu.nl/en">
                    <img src="/yoda/assets/images/uu-logo.svg" alt="Logo Utrecht University">
                </a>

                <div class="visible-print-block">
                    <h1>YODA</h1>
                </div>
            </div>

            <div class="col-sm-6 col-xs-4 hidden-print" role="search">
                <!--
                <div class="pull-right">
                    <form method="get" id="searchform" action="https://yoda.sites.uu.nl">
                        <div class="search-wrapper">
                            <label class="screen-reader-text" for="s">'</label>
                            <input type="text" class="searchfield" value="" name="s" id="s" placeholder="Search the Site...">
                            <input type="submit" id="searchsubmit" class="searchbutton" value="">
                        </div>
                    </form>
                </div>
                -->
            </div>
        </div>
    </div>
</div>
<header id="masthead" class="header hidden-print">
    <div class="container">
        <h1>
            <a href="/yoda" rel="home" title="YODA">
                YODA
            </a>
        </h1>
    </div>
</header>

<a class="skip-link sr-only" href="#content">Skip to content</a>

<!-- MAIN MENU -->
<nav id="#access" class="navbar navbar-default navbar-inverse">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="container">
        <div class="navbar-header"></div>
        <div id="main-menu-collapse" class="collapse navbar-collapse">
            <ul id="menu-hoofdmenu" class="nav navbar-nav">
                
                
                
                <li class="first-item menu-item menu-item-type-post_type menu-item-object-page dropdown">
                    <a title="Release notes" href="/yoda/release-notes/index.html">Release notes</a>
                    
                    
                    
                    <ul class="submenu visible-xs visible-sm nav navbar-nav">
                        
                        
                        <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                            <a title="Release 1.6" href="/yoda/release-notes/release-1.6.html">
                                Release 1.6
                            </a>
                        </li>
                        
                        
                        <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                            <a title="Release 1.5" href="/yoda/release-notes/release-1.5.html">
                                Release 1.5
                            </a>
                        </li>
                        
                        
                        <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                            <a title="Release 1.4" href="/yoda/release-notes/release-1.4.html">
                                Release 1.4
                            </a>
                        </li>
                        
                        
                        <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                            <a title="Release 1.3" href="/yoda/release-notes/release-1.3.html">
                                Release 1.3
                            </a>
                        </li>
                        
                        
                        <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                            <a title="Release 1.2" href="/yoda/release-notes/release-1.2.html">
                                Release 1.2
                            </a>
                        </li>
                        
                        
                        <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                            <a title="Release 1.1" href="/yoda/release-notes/release-1.1.html">
                                Release 1.1
                            </a>
                        </li>
                        
                        
                        <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                            <a title="Release 1.0" href="/yoda/release-notes/release-1.0.html">
                                Release 1.0
                            </a>
                        </li>
                        
                        
                        <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                            <a title="Release 0.9.7" href="/yoda/release-notes/release-0.9.7.html">
                                Release 0.9.7
                            </a>
                        </li>
                        
                    </ul>
                    
                </li>
                
                
                <li class="first-item menu-item menu-item-type-post_type menu-item-object-page dropdown">
                    <a title="Administration" href="/yoda/administration/index.html">Administration</a>
                    
                    
                    
                    <ul class="submenu visible-xs visible-sm nav navbar-nav">
                        
                        
                        <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                            <a title="Installing Licenses" href="/yoda/administration/installing-licenses.html">
                                Installing Licenses
                            </a>
                        </li>
                        
                        
                        <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                            <a title="Installing terms" href="/yoda/administration/installing-terms.html">
                                Installing terms
                            </a>
                        </li>
                        
                        
                        <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                            <a title="Installing metadata schemas" href="/yoda/administration/installing-metadata-schemas.html">
                                Installing metadata schemas
                            </a>
                        </li>
                        
                        
                        <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                            <a title="Upgrading metadata schemas" href="/yoda/administration/upgrading-metadata-schemas.html">
                                Upgrading metadata schemas
                            </a>
                        </li>
                        
                        
                        <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                            <a title="Background jobs" href="/yoda/administration/background-jobs.html">
                                Background jobs
                            </a>
                        </li>
                        
                        
                        <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                            <a title="Troubleshooting publication" href="/yoda/administration/troubleshooting-publication.html">
                                Troubleshooting publication
                            </a>
                        </li>
                        
                        
                        <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                            <a title="Restore collection" href="/yoda/administration/restore-collection.html">
                                Restore collection
                            </a>
                        </li>
                        
                    </ul>
                    
                </li>
                
                
                <li class="first-item menu-item menu-item-type-post_type menu-item-object-page dropdown">
                    <a title="Development" href="/yoda/development/index.html">Development</a>
                    
                    
                    
                    <ul class="submenu visible-xs visible-sm nav navbar-nav">
                        
                        
                        <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                            <a title="Setting up development environment" href="/yoda/development/setting-up-development-environment.html">
                                Setting up development environment
                            </a>
                        </li>
                        
                        
                        <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                            <a title="Development environment test users and data" href="/yoda/development/development-test-data.html">
                                Development environment test users and data
                            </a>
                        </li>
                        
                    </ul>
                    
                </li>
                
                
                <li class="first-item menu-item menu-item-type-post_type menu-item-object-page dropdown">
                    <a title="Software design" href="/yoda/design/index.html">Software design</a>
                    
                    
                    
                    <ul class="submenu visible-xs visible-sm nav navbar-nav">
                        
                        
                        <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                            <a title="System overview" href="/yoda/design/system-overview.html">
                                System overview
                            </a>
                        </li>
                        
                        
                        <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                            <a title="Research space" href="/yoda/design/research-space.html">
                                Research space
                            </a>
                        </li>
                        
                        
                        <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                            <a title="Vault space" href="/yoda/design/vault-space.html">
                                Vault space
                            </a>
                        </li>
                        
                        
                        <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                            <a title="Asynchronous and privileged execution" href="/yoda/design/async-system-execution.html">
                                Asynchronous and privileged execution
                            </a>
                        </li>
                        
                        
                        <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                            <a title="External user service" href="/yoda/design/external-user-service.html">
                                External user service
                            </a>
                        </li>
                        
                        
                        <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                            <a title="Group manager" href="/yoda/design/group-manager.html">
                                Group manager
                            </a>
                        </li>
                        
                        
                        <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                            <a title="Locking mechanism" href="/yoda/design/locking-mechanism.html">
                                Locking mechanism
                            </a>
                        </li>
                        
                        
                        <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                            <a title="Metadata form" href="/yoda/design/metadata-form.html">
                                Metadata form
                            </a>
                        </li>
                        
                        
                        <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                            <a title="Publication process" href="/yoda/design/publication-process.html">
                                Publication process
                            </a>
                        </li>
                        
                        
                        <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                            <a title="Python plugin" href="/yoda/design/python-plugin.html">
                                Python plugin
                            </a>
                        </li>
                        
                        
                        <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                            <a title="Statistics module" href="/yoda/design/statistics.html">
                                Statistics module
                            </a>
                        </li>
                        
                        
                        <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                            <a title="Revision management" href="/yoda/design/revisions.html">
                                Revision management
                            </a>
                        </li>
                        
                        
                        <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown current-menu-item">
                            <a title="Vault process" href="/yoda/design/vault-process.html">
                                Vault process
                            </a>
                        </li>
                        
                    </ul>
                    
                </li>
                
            </ul>
        </div>
    </div>
</nav>
<!-- /MAIN MENU -->


            <div id="content" class="two-col">
                <header class="article-header article-header-main">
                    <div class="header-image hidden-print">

                        
                        <div class="breadcrumbs" xmlns:v="https://rdf.data-vocabulary.org/#">
                            <div class="container">
							<span property="itemListElement" typeof="ListItem">
								<span property="name">YODA</span>
								<meta property="position" content="1">
							</span>
                            </div>
                        </div>
                        

                        <img src="/yoda/assets/images/header.jpg" alt="">

                        
                        <div class="page-header-placeholder"></div>
                        
                    </div>
                </header>

                <div id="content-wrapper" class="container">
                    <div class="row-offcanvas row-offcanvas-left">
                        <div id="left-sidebar" class="sidebar-offcanvas clearfix hidden-print" role="complementary">
                            <!-- PAGE MENU -->
                            
                            
                            
                            <div class="widget-1 first-widget widget widget_nav_menu">
                                <h4 class="widgettitle">Menu</h4>
                                <div class="menu-hoofdmenu-container">
                                    <!-- PAGE MENU -->
                                    <ul class="menu">
                                        
                                        
                                            
                                            <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                                                <a href="/yoda/design/system-overview.html">System overview</a>
                                            </li>
                                        
                                            
                                            <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                                                <a href="/yoda/design/research-space.html">Research space</a>
                                            </li>
                                        
                                            
                                            <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                                                <a href="/yoda/design/vault-space.html">Vault space</a>
                                            </li>
                                        
                                            
                                            <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                                                <a href="/yoda/design/async-system-execution.html">Asynchronous and privileged execution</a>
                                            </li>
                                        
                                            
                                            <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                                                <a href="/yoda/design/external-user-service.html">External user service</a>
                                            </li>
                                        
                                            
                                            <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                                                <a href="/yoda/design/group-manager.html">Group manager</a>
                                            </li>
                                        
                                            
                                            <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                                                <a href="/yoda/design/locking-mechanism.html">Locking mechanism</a>
                                            </li>
                                        
                                            
                                            <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                                                <a href="/yoda/design/metadata-form.html">Metadata form</a>
                                            </li>
                                        
                                            
                                            <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                                                <a href="/yoda/design/publication-process.html">Publication process</a>
                                            </li>
                                        
                                            
                                            <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                                                <a href="/yoda/design/python-plugin.html">Python plugin</a>
                                            </li>
                                        
                                            
                                            <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                                                <a href="/yoda/design/statistics.html">Statistics module</a>
                                            </li>
                                        
                                            
                                            <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                                                <a href="/yoda/design/revisions.html">Revision management</a>
                                            </li>
                                        
                                            
                                            <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children current-menu-item">
                                                <a href="/yoda/design/vault-process.html">Vault process</a>
                                            </li>
                                        
                                    </ul>
                                </div>
                            </div>
                            
                            <!-- /PAGE MENU -->
                        </div>

                        <div class="page-content clearfix">
                            
                            <div class="page-title">
                                <h1>
                                    To vault process in research module
                                </h1>
                            </div>
                            
			    <!--
                            <div class="toggle-btn-div visible-xs clearfix">
                                <button type="button" class="toggle-btn white button icon left arrow-right" data-toggle="offcanvas">
                                    Show sidebar
                                </button>
                            </div>
                            -->
                            <div class="page-content-inner facetwp-template">

                                <article id="post-6" class="clearfix post-6 page type-page status-publish hentry first-post">
                                    <section class="entry-content">
                                        <h1 id="to-vault-process-in-research-module">To vault process in research module</h1>

<p>This document does not fully describe the process to push datapackages to the vault. Only the
technical choices made to implement the process are described here. The process is described
in the architectural state model.</p>

<h2 id="folder-status">Folder status</h2>
<p>Each folder in the research area is initialized without any status information. This is regarded as the folder status <em>Folder</em>. Every other status is defined
by the metadata field <em>org_status</em> on the collection. The valid statuses and transitions are defined in iiConstant like below.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># \brief All research folder states.
FOLDER = "";
LOCKED = "LOCKED";
SUBMITTED = "SUBMITTED";
ACCEPTED = "ACCEPTED";
REJECTED = "REJECTED";
SECURED = "SECURED";

# \constant IIFOLDERTRANSITIONS
IIFOLDERTRANSITIONS = list((FOLDER, LOCKED),
			   (FOLDER, SUBMITTED),
			   (LOCKED, FOLDER),
			   (LOCKED, SUBMITTED),
			   (SUBMITTED, FOLDER),
			   (SUBMITTED, ACCEPTED),
			   (SUBMITTED, REJECTED),
			   (REJECTED, LOCKED),
			   (REJECTED, FOLDER),
			   (REJECTED, SUBMITTED),
			   (ACCEPTED, SECURED),
			   (SECURED, LOCKED),
			   (SECURED, FOLDER),
			   (SECURED, SUBMITTED))
</code></pre></div></div>

<h2 id="status-policies">Status Policies</h2>
<p>All the status transitions are handled by rules in <em>iiFolderStatusTransistions.r</em>. Basically they set the org_status of the folder to the new status and
PEP’s in <em>iiPolicies.r</em> will check if the transition is legal and call pre and post procedures for each transition. The checks if a status transition is
allowed are found in <em>iiPolicyChecks.r</em>.</p>

<p>The pre and post conditions are run based on the manipulation of the <em>org_status</em> metadata. This means every status transition can be triggered with the
<em>imeta</em> command. Illegal transitions will be blocked with <em>msiOprDisallowed</em>.</p>

<h2 id="datamanager-approval">Datamanager approval</h2>
<p>When a datamanager is present, a datapackage submitted to the vault by a researcher will remain in the submitted state. The datamanager can approve or reject
the package for further processing. A researcher also has the opportunity to unsubmit the package. Because a datamanager only has read access to the research
area, he/she cannot edit the <em>org_status</em> directly. To work around this issue the sudo microservices are used to temporarily enable the datamanager to set the
<em>org_status</em> to ‘ACCEPTED’ or ‘REJECTED’. The rules can be found in <em>iiDatamanagerPolicies.r</em> and <em>iiSudoPolicies.r</em>.</p>

<p>A research group without a datamanager can submit packages to the vault directly. Any submitted folder will be transitioned to ‘ACCEPTED’ state immediately after
submission.</p>

<h2 id="copy-to-vault">Copy to vault</h2>
<p>The <strong>copy-accepted-folders-to-vault.r</strong> cronjob in the tools directory of the research ruleset will copy any folder in ‘ACCEPTED’ state to the vault and set it to
‘SECURED’ state when successful. The copy is done recursively using the uuTreeWalk rule starting from the the ‘ACCEPTED’ folder. The metadata will be copied as well.</p>

<h2 id="research-vault">Research vault</h2>
<p>For each research group a vault group with a vault collection is created. Only the rodsadmin will be a member. This folder is read-only for managers
and normal users of the research group. When a datamanager group for the category is present it will get read-only access as well. Inheritance is
switched off. This makes it possible to manage permissions for each vault package separately. A datamanager gets control over it.</p>

<h2 id="granting-and-revoking-read-access-to-the-vault-for-the-research-group">Granting and revoking read access to the vault for the research group</h2>
<p>The datamanager is allowed to use the sudo microservice msiSudoObjAclSet to grant and revoke read access to packages in the vault. This is configured in
<em>iiSudoPolicies.r</em> and <em>iiDatamanagerPolicies.r</em> to not interfere with existing sudo policies in the irods-ruleset-uu. The only action the datamanager is
allowed to do is set permissions starting from the root of a vault package to read for the research group with the same basename as the vault.</p>

<h2 id="no-datamanager">No datamanager</h2>
<p>When there is no datamanager is present the permissions can only be managed by the rodsadmin. Read-only for the research group by default could be implemented.</p>

                                    </section>

                                    <footer class="article-footer"></footer>
                                </article>
                            </div> <!-- /page-content-inner -->
                        </div> <!-- /page-content -->
                    </div> <!--row-offcanvas -->
                </div> <!-- /#content-wrapper -->
            </div>

            <footer id="colophon" class="footer hidden-print">
                <div id="inner-footer" class="container clearfix">
                    <div class="row">
                        <div class="col-sm-6">
                            <img alt="Logo Utrecht University" src="/yoda/assets/images/uu-logo-footer.svg">
                        </div>
                        <div class="col-sm-6">
                            <p class="source-org copyright pull-right">© 2020 Utrecht University, <a href="https://www.uu.nl/en/organisation/contact/disclaimer">disclaimer</a></p>
                        </div>
                    </div>
                </div>
            </footer>

            <p id="back-top" style="display: none;">
                <a href="#top"><i class="fa fa-angle-up"></i></a>
            </p>

            <script type="text/javascript" src='/yoda/assets/js/jquery.js'></script>
<script type="text/javascript" src='/yoda/assets/js/bootstrap.min.js'></script>
        </div>
    </body>
</html>
