<!DOCTYPE html>
<html lang="en">
    <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <link rel="icon" href="yoda/assets/images/favicon.ico">

  <title>How to deal with hanging publications</title>

  <link rel='stylesheet' id='bootstrap-css'  href='//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css' type='text/css' media='all' />
  <link rel="stylesheet" href="yoda/assets/css/style.css" type="text/css" media="screen" />
  <link rel="stylesheet" href="yoda/assets/css/custom.css" type="text/css" media="screen" />
  <link rel="stylesheet" href="yoda/assets/css/print.css" type="text/css" media="print" />
</head>

    <body data-rsssl="1" class="page-template-default page page-id-6 page-parent" data-spy="scroll" data-target="#sidebarnav">
        <div id="page">

            <div id="brandbar" class="affix-top">
    <div class="container">
        <div class="row">
            <div class="col-sm-4 col-xs-8 logodiv">
                <button type="button" class="navbar-toggle hidden-print" data-toggle="collapse" data-target="#main-menu-collapse">
                    <span class="sr-only">Navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a href="https://www.uu.nl/en">
                    <img src="yoda/assets/images/uu-logo.svg" alt="Logo Utrecht University">
                </a>

                <div class="visible-print-block">
                    <h1>YODA</h1>
                </div>
            </div>

            <div class="col-sm-6 col-xs-4 hidden-print" role="search">
                <!--
                <div class="pull-right">
                    <form method="get" id="searchform" action="https://yoda.sites.uu.nl">
                        <div class="search-wrapper">
                            <label class="screen-reader-text" for="s">'</label>
                            <input type="text" class="searchfield" value="" name="s" id="s" placeholder="Search the Site...">
                            <input type="submit" id="searchsubmit" class="searchbutton" value="">
                        </div>
                    </form>
                </div>
                -->
            </div>
        </div>
    </div>
</div>
<header id="masthead" class="header hidden-print">
    <div class="container">
        <h1>
            <a href="yoda" rel="home" title="YODA">
                YODA
            </a>
        </h1>
    </div>
</header>

<a class="skip-link sr-only" href="#content">Skip to content</a>

<!-- MAIN MENU -->
<nav id="#access" class="navbar navbar-default navbar-inverse">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="container">
        <div class="navbar-header"></div>
        <div id="main-menu-collapse" class="collapse navbar-collapse">
            <ul id="menu-hoofdmenu" class="nav navbar-nav">
                
                <li class="first-item menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                    
                    <a title="Release notes" href="yoda/release-notes/index.html">Release notes</a>
                    
                </li>
                
                <li class="first-item menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                    
                    <a title="Administration" href="yoda/administration/index.html">Administration</a>
                    
                </li>
                
                <li class="first-item menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                    
                    <a title="Development" href="yoda/development/index.html">Development</a>
                    
                </li>
                
                <li class="first-item menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children dropdown">
                    
                    <a title="Software design" href="yoda/design/index.html">Software design</a>
                    
                </li>
                
            </ul>
        </div>
    </div>
</nav>
<!-- /MAIN MENU -->


            <div id="content" class="two-col">
                <header class="article-header article-header-main">
                    <div class="header-image hidden-print">

                        
                        <div class="breadcrumbs" xmlns:v="https://rdf.data-vocabulary.org/#">
                            <div class="container">
							<span property="itemListElement" typeof="ListItem">
								<span property="name">YODA</span>
								<meta property="position" content="1">
							</span>
                            </div>
                        </div>
                        

                        <img src="yoda/assets/images/header.jpg" alt="">

                        
                        <div class="page-header-placeholder"></div>
                        
                    </div>
                </header>

                <div id="content-wrapper" class="container">
                    <div class="row-offcanvas row-offcanvas-left">
                        <div id="left-sidebar" class="sidebar-offcanvas clearfix hidden-print" role="complementary">
                            <!-- PAGE MENU -->
                            
                            
                            
                            <div class="widget-1 first-widget widget widget_nav_menu">
                                <h4 class="widgettitle">Menu</h4>
                                <div class="menu-hoofdmenu-container">
                                    <!-- PAGE MENU -->
                                    <ul class="menu">
                                        
                                        
                                            
                                            <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                                                <a href="yoda/administration/installing-licenses.html">Installing Licenses</a>
                                            </li>
                                        
                                            
                                            <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                                                <a href="yoda/administration/installing-terms.html">Installing terms</a>
                                            </li>
                                        
                                            
                                            <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                                                <a href="yoda/administration/installing-metadata-schemas.html">Installing metadata schemas</a>
                                            </li>
                                        
                                            
                                            <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                                                <a href="yoda/administration/upgrading-metadata-schemas.html">Upgrading metadata schemas</a>
                                            </li>
                                        
                                            
                                            <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                                                <a href="yoda/administration/background-jobs.html">Background jobs</a>
                                            </li>
                                        
                                            
                                            <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children current-menu-item">
                                                <a href="yoda/administration/troubleshooting-publication.html">Troubleshooting publication</a>
                                            </li>
                                        
                                            
                                            <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                                                <a href="yoda/administration/restore-collection.html">Restore collection</a>
                                            </li>
                                        
                                    </ul>
                                </div>
                            </div>
                            
                            <!-- /PAGE MENU -->    
                        </div>

                        <div class="page-content clearfix">
                            
                            <div class="page-title">
                                <h1>
                                    How to deal with hanging publications
                                </h1>
                            </div>
                            
			    <!--
                            <div class="toggle-btn-div visible-xs clearfix">
                                <button type="button" class="toggle-btn white button icon left arrow-right" data-toggle="offcanvas">
                                    Show sidebar
                                </button>
                            </div>
                            -->
                            <div class="page-content-inner facetwp-template">

                                <article id="post-6" class="clearfix post-6 page type-page status-publish hentry first-post">
                                    <section class="entry-content">
                                        <h1 id="how-to-deal-with-hanging-publications">How to deal with hanging publications</h1>

<p>When a publication stays in Approved status for an extended period of time (longer than cronjob interval) something probably went
wrong. Here are some troubleshooting hints.</p>

<p>First look for <code class="highlighter-rouge">iiProcessPublication</code> in <code class="highlighter-rouge">/var/lib/irods/log/rodsLog</code>. It will show the processing of the publication.</p>

<ul>
  <li>When a publication succeeds it will return status OK.</li>
  <li>When the publication process has caught an error, but has no recovery process it will return <code class="highlighter-rouge">Unrecoverable</code> as status.</li>
  <li>When the whole process was interrupted at a time the error could not be caught, the status will stay at <code class="highlighter-rouge">Processing</code>.</li>
  <li>When the publication process encountered a DOI collision it will set status to <code class="highlighter-rouge">Retry</code> and reset the generated random ID.</li>
  <li>When the publication process encounters connectivity problems with DataCite or the public server it will set the status to <code class="highlighter-rouge">Retry</code>.</li>
</ul>

<p>Then look at the rodsLog around the time of the problem. Error messages could give you a hint on the root cause.</p>

<p>The publication process saves its state in metadata on the vault package. You can use imeta to list the details. See an example below.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>imeta lsw <span class="nt">-C</span> /tempZone/home/vault-test/research-test[123456789] org_publication%
</code></pre></div></div>

<p>When the problem is caused by invalid metadata, check the value of <code class="highlighter-rouge">org_publication_combiXmlPath</code> and <code class="highlighter-rouge">org_publication_dataCiteXmlPath</code>. You can use iget to download the generated metadata at these paths and check for XML/XSLT related problems.</p>

<p>When the <code class="highlighter-rouge">org_publication_status</code> is <code class="highlighter-rouge">Retry</code> the publication process will be retried until success.
Check status.datacite.org if you suspect a DataCite problem.
Publications will fail if the API servers are down.<br />
Check the ability of the rods user to set up a ssh connection with the inbox user on the public Yoda server.
When troubleshooting was successful the publication process will skip the subtasks
before the failure and continue.</p>

<p>When the <code class="highlighter-rouge">org_publication_status</code> is <code class="highlighter-rouge">Processing</code> and the root cause of the crash looks to be incidental, you could set the status to <code class="highlighter-rouge">Retry</code> with  imeta on the <code class="highlighter-rouge">org_publication_status</code>. The publication will be retried the next time the cronjob runs.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>imeta <span class="nb">set</span> <span class="nt">-C</span> /tempZone/home/vault-test/research-test[123456789] org_publication_status Retry
</code></pre></div></div>

<p>When the <code class="highlighter-rouge">org_publication_status</code> is <code class="highlighter-rouge">Unrecoverable</code> then one of XSLT conversion steps have produced invalid metadata.
You could use a third party XSLT processor on the metadata in the previously mentioned source XML files with the used XSL’s from the current category.
This could tell you the problem.
If the metadata generation succeeds but is still invalid according to the DataCite API, you could use an XSD validator on the datacite.xml using the version 4 XSD’s found at schema.datacite.org.</p>

                                    </section>

                                    <footer class="article-footer"></footer>
                                </article>
                            </div> <!-- /page-content-inner -->
                        </div> <!-- /page-content -->
                    </div> <!--row-offcanvas -->
                </div> <!-- /#content-wrapper -->
            </div>

            <footer id="colophon" class="footer hidden-print">
                <div id="inner-footer" class="container clearfix">
                    <div class="row">
                        <div class="col-sm-6">
                            <img alt="Logo Utrecht University" src="yoda/assets/images/uu-logo-footer.svg">
                        </div>
                        <div class="col-sm-6">
                            <p class="source-org copyright pull-right">© 2019 Utrecht University, <a href="https://www.uu.nl/en/organisation/contact/disclaimer">disclaimer</a></p>
                        </div>
                    </div>
                </div>
            </footer>

            <p id="back-top" style="display: none;">
                <a href="#top"><i class="fa fa-angle-up"></i></a>
            </p>

            <script type="text/javascript" src='yoda/assets/js/jquery.js'></script>
<script type="text/javascript" src='yoda/assets/js/bootstrap.min.js'></script>
        </div>
    </body>
</html>
