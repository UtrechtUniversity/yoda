

<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  <link rel="stylesheet" href="/yoda/assets/css/just-the-docs-default.css">

  <link rel="stylesheet" href="/yoda/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet">

  <style id="jtd-nav-activation">
  

.site-nav > ul.nav-list:first-child > li > a,
.site-nav > ul.nav-list:first-child > li > ul > li:not(:nth-child(15)) > a,
.site-nav > ul.nav-list:first-child > li > ul > li > ul > li > a {
  background-image: none;
}

.site-nav > ul.nav-list:not(:first-child) a,
.site-nav li.external a {
  background-image: none;
}

.site-nav > ul.nav-list:first-child > li:nth-child(4) > ul > li:nth-child(15) > a {
  font-weight: 600;
  text-decoration: none;
}.site-nav > ul.nav-list:first-child > li:nth-child(4) > button svg,
.site-nav > ul.nav-list:first-child > li:nth-child(4) > ul > li:nth-child(15) > button svg {
  transform: rotate(-90deg);
}.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(4) > ul.nav-list,
.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(4) > ul.nav-list > li.nav-list-item:nth-child(15) > ul.nav-list {
  display: block;
}
  </style>

  

  
    <script src="/yoda/assets/js/vendor/lunr.min.js"></script>
  

  <script src="/yoda/assets/js/just-the-docs.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  

  <link rel="icon" href="/yoda/favicon.ico" type="image/x-icon">



  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Upgrading PostgreSQL | Yoda</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="Upgrading PostgreSQL" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="On this website you can find release notes and technical documentation on software design and administration tasks of Yoda" />
<meta property="og:description" content="On this website you can find release notes and technical documentation on software design and administration tasks of Yoda" />
<meta property="og:site_name" content="Yoda" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Upgrading PostgreSQL" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"On this website you can find release notes and technical documentation on software design and administration tasks of Yoda","headline":"Upgrading PostgreSQL","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/yoda/yoda.svg"}},"url":"/yoda/administration/upgrading-postgresql.html"}</script>
<!-- End Jekyll SEO tag -->


  

</head>

<body>
  <a class="skip-to-main" href="#main-content">Skip to main content</a>
  <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="svg-link" viewBox="0 0 24 24">
  <title>Link</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link">
    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
  </svg>
</symbol>

  <symbol id="svg-menu" viewBox="0 0 24 24">
  <title>Menu</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
    <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
  </svg>
</symbol>

  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
  <title>Expand</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
    <polyline points="9 18 15 12 9 6"></polyline>
  </svg>
</symbol>

  <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE -->
<symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link">
  <title id="svg-external-link-title">(external link)</title>
  <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line>
</symbol>

  
    <symbol id="svg-doc" viewBox="0 0 24 24">
  <title>Document</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file">
    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline>
  </svg>
</symbol>

    <symbol id="svg-search" viewBox="0 0 24 24">
  <title>Search</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
    <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
  </svg>
</symbol>

  
  
    <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md -->
<symbol id="svg-copy" viewBox="0 0 16 16">
  <title>Copy</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
    <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
  </svg>
</symbol>
<symbol id="svg-copied" viewBox="0 0 16 16">
  <title>Copied</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16">
    <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/>
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/>
  </svg>
</symbol>

  
</svg>

  
    <div class="side-bar">
  <div class="site-header" role="banner">
    <a href="/yoda/" class="site-title lh-tight">
  <div class="site-logo" role="img" aria-label="Yoda"></div>

</a>
    <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false">
      <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg>
    </button>
  </div>

  <nav aria-label="Main" id="site-nav" class="site-nav">
  
  
    <ul class="nav-list"><li class="nav-list-item"><a href="/yoda/" class="nav-list-link">Home</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Release Notes category" aria-pressed="false">
      <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
    </button><a href="/yoda/release-notes/" class="nav-list-link">Release Notes</a><ul class="nav-list"><li class="nav-list-item"><a href="/yoda/release-notes/release-1.9.html" class="nav-list-link">v1.9</a></li><li class="nav-list-item"><a href="/yoda/release-notes/release-1.8.html" class="nav-list-link">v1.8</a></li><li class="nav-list-item"><a href="/yoda/release-notes/release-1.7.html" class="nav-list-link">v1.7</a></li><li class="nav-list-item"><a href="/yoda/release-notes/release-1.6.html" class="nav-list-link">v1.6</a></li><li class="nav-list-item"><a href="/yoda/release-notes/release-1.5.html" class="nav-list-link">v1.5</a></li><li class="nav-list-item"><a href="/yoda/release-notes/release-1.4.html" class="nav-list-link">v1.4</a></li><li class="nav-list-item"><a href="/yoda/release-notes/release-1.3.html" class="nav-list-link">v1.3</a></li><li class="nav-list-item"><a href="/yoda/release-notes/release-1.2.html" class="nav-list-link">v1.2</a></li><li class="nav-list-item"><a href="/yoda/release-notes/release-1.1.html" class="nav-list-link">v1.1</a></li><li class="nav-list-item"><a href="/yoda/release-notes/release-1.0.html" class="nav-list-link">v1.0</a></li><li class="nav-list-item"><a href="/yoda/release-notes/release-0.9.7.html" class="nav-list-link">v0.9.7</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Software Design category" aria-pressed="false">
      <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
    </button><a href="/yoda/design/" class="nav-list-link">Software Design</a><ul class="nav-list"><li class="nav-list-item"><a href="/yoda/design/api/" class="nav-list-link">API</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in System Overview category" aria-pressed="false">
            <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
          </button><a href="/yoda/design/overview/" class="nav-list-link">System Overview</a><ul class="nav-list"><li class="nav-list-item">
                <a href="/yoda/design/overview/research-space.html" class="nav-list-link">Research space</a>
              </li><li class="nav-list-item">
                <a href="/yoda/design/overview/vault-space.html" class="nav-list-link">Vault space</a>
              </li><li class="nav-list-item">
                <a href="/yoda/design/overview/group-manager.html" class="nav-list-link">Group manager</a>
              </li><li class="nav-list-item">
                <a href="/yoda/design/overview/statistics.html" class="nav-list-link">Statistics module</a>
              </li><li class="nav-list-item">
                <a href="/yoda/design/overview/deposit-space.html" class="nav-list-link">Deposit space</a>
              </li><li class="nav-list-item">
                <a href="/yoda/design/overview/statistics_1.8.html" class="nav-list-link">Statistics module (v1.8 or earlier)</a>
              </li><li class="nav-list-item">
                <a href="/yoda/design/overview/theme-packages.html" class="nav-list-link">Theme packaging</a>
              </li><li class="nav-list-item">
                <a href="/yoda/design/overview/intake.html" class="nav-list-link">Intake module</a>
              </li><li class="nav-list-item">
                <a href="/yoda/design/overview/vault-archive.html" class="nav-list-link">Vault archive</a>
              </li><li class="nav-list-item">
                <a href="/yoda/design/overview/data-requests.html" class="nav-list-link">Data requests module</a>
              </li><li class="nav-list-item">
                <a href="/yoda/design/overview/authentication.html" class="nav-list-link">Authentication</a>
              </li><li class="nav-list-item">
                <a href="/yoda/design/overview/data_package_reference.html" class="nav-list-link">Data Package Reference</a>
              </li><li class="nav-list-item">
                <a href="/yoda/design/overview/deployment.html" class="nav-list-link">Deployment</a>
              </li><li class="nav-list-item">
                <a href="/yoda/design/overview/external-user-service.html" class="nav-list-link">External User Service</a>
              </li><li class="nav-list-item">
                <a href="/yoda/design/overview/yoda-moai.html" class="nav-list-link">Yoda MOAI service</a>
              </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Metadata category" aria-pressed="false">
            <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
          </button><a href="/yoda/design/metadata/" class="nav-list-link">Metadata</a><ul class="nav-list"><li class="nav-list-item">
                <a href="/yoda/design/metadata/adr-schema-identifiers.html" class="nav-list-link">Architectural decision record schema identifier format</a>
              </li><li class="nav-list-item">
                <a href="/yoda/design/metadata/metadata-form-json.html" class="nav-list-link">Metadata JSON schema</a>
              </li><li class="nav-list-item">
                <a href="/yoda/design/metadata/metadata-form.html" class="nav-list-link">Metadata form implementation</a>
              </li><li class="nav-list-item">
                <a href="/yoda/design/metadata/schema-configuration.html" class="nav-list-link">Metadata schemas</a>
              </li><li class="nav-list-item">
                <a href="/yoda/design/metadata/metadata-vault.html" class="nav-list-link">Metadata vault</a>
              </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Processes category" aria-pressed="false">
            <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
          </button><a href="/yoda/design/processes/" class="nav-list-link">Processes</a><ul class="nav-list"><li class="nav-list-item">
                <a href="/yoda/design/processes/async-system-execution.html" class="nav-list-link">Asynchronous and Privileged Execution</a>
              </li><li class="nav-list-item">
                <a href="/yoda/design/processes/asynchronous-processes.html" class="nav-list-link">Asynchronous processes</a>
              </li><li class="nav-list-item">
                <a href="/yoda/design/processes/automatic-resource-balancing.html" class="nav-list-link">Automatic Resource Balancing</a>
              </li><li class="nav-list-item">
                <a href="/yoda/design/processes/copy-to-vault-diagrams.html" class="nav-list-link">Copy to vault diagrams</a>
              </li><li class="nav-list-item">
                <a href="/yoda/design/processes/locking-mechanism.html" class="nav-list-link">Folder Locking mechanism</a>
              </li><li class="nav-list-item">
                <a href="/yoda/design/processes/publication-process.html" class="nav-list-link">Publication Process</a>
              </li><li class="nav-list-item">
                <a href="/yoda/design/processes/revisions.html" class="nav-list-link">Revision management</a>
              </li><li class="nav-list-item">
                <a href="/yoda/design/processes/vault-process.html" class="nav-list-link">To vault process in research module</a>
              </li></ul></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Administration Tasks category" aria-pressed="false">
      <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
    </button><a href="/yoda/administration/" class="nav-list-link">Administration Tasks</a><ul class="nav-list"><li class="nav-list-item"><a href="/yoda/administration/configuring-yoda.html" class="nav-list-link">Configuring Yoda</a></li><li class="nav-list-item"><a href="/yoda/administration/deploying-yoda.html" class="nav-list-link">Deploying Yoda</a></li><li class="nav-list-item"><a href="/yoda/administration/hotfixing-ruleset.html" class="nav-list-link">Hotfixing ruleset</a></li><li class="nav-list-item"><a href="/yoda/administration/local-ruleset-patch.html" class="nav-list-link">Local ruleset patches</a></li><li class="nav-list-item"><a href="/yoda/administration/installing-licenses.html" class="nav-list-link">Installing Licenses</a></li><li class="nav-list-item"><a href="/yoda/administration/installing-terms.html" class="nav-list-link">Installing Terms & Conditions</a></li><li class="nav-list-item"><a href="/yoda/administration/installing-preservable-file-formats.html" class="nav-list-link">Installing lists of preservable file formats</a></li><li class="nav-list-item"><a href="/yoda/administration/installing-metadata-schemas.html" class="nav-list-link">Installing metadata schemas</a></li><li class="nav-list-item"><a href="/yoda/administration/local-postfix-mta.html" class="nav-list-link">Local Postfix MTA</a></li><li class="nav-list-item"><a href="/yoda/administration/installing-datarequest-module.html" class="nav-list-link">Installing datarequest module</a></li><li class="nav-list-item"><a href="/yoda/administration/upgrading-metadata-schemas.html" class="nav-list-link">Upgrading metadata schemas</a></li><li class="nav-list-item"><a href="/yoda/administration/troubleshooting-publication.html" class="nav-list-link">Troubleshooting publication</a></li><li class="nav-list-item"><a href="/yoda/administration/using-python-irodsclient.html" class="nav-list-link">Using the python-irodsclient API</a></li><li class="nav-list-item"><a href="/yoda/administration/troubleshooting-email.html" class="nav-list-link">Troubleshooting email</a></li><li class="nav-list-item"><a href="/yoda/administration/upgrading-postgresql.html" class="nav-list-link">Upgrading PostgreSQL</a></li><li class="nav-list-item"><a href="/yoda/administration/configuring-openidc.html" class="nav-list-link">Configuring OIDC</a></li><li class="nav-list-item"><a href="/yoda/administration/troubleshooting-replication-revisions.html" class="nav-list-link">Troubleshooting replication and revision creation</a></li><li class="nav-list-item"><a href="/yoda/administration/configuring-cleanup-temporary-files.html" class="nav-list-link">Configuring cleanup functionality temporary files</a></li><li class="nav-list-item"><a href="/yoda/administration/configuring-data-access-passwords.html" class="nav-list-link">Configuring Data Access Passwords</a></li><li class="nav-list-item"><a href="/yoda/administration/restore-collection.html" class="nav-list-link">Restore collection</a></li><li class="nav-list-item"><a href="/yoda/administration/setting-job-flags.html" class="nav-list-link">Setting job flags</a></li><li class="nav-list-item"><a href="/yoda/administration/supported-distributions.html" class="nav-list-link">Supported distributions</a></li><li class="nav-list-item"><a href="/yoda/administration/deprovision-users.html" class="nav-list-link">Deprovision users</a></li><li class="nav-list-item"><a href="/yoda/administration/troubleshooting-copy-to-vault.html" class="nav-list-link">Troubleshooting data package archival in the vault</a></li><li class="nav-list-item"><a href="/yoda/administration/portal-tech-support-info.html" class="nav-list-link">Collecting portal technical support information</a></li><li class="nav-list-item"><a href="/yoda/administration/troubleshooting-vault-metadata.html" class="nav-list-link">Troubleshooting problems with vault metadata</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Development category" aria-pressed="false">
      <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
    </button><a href="/yoda/development/" class="nav-list-link">Development</a><ul class="nav-list"><li class="nav-list-item"><a href="/yoda/development/setting-up-development-environment.html" class="nav-list-link">Setting up development environment</a></li><li class="nav-list-item"><a href="/yoda/development/docker-setup.html" class="nav-list-link">Running Yoda using Docker Compose</a></li><li class="nav-list-item"><a href="/yoda/development/running-api-ui-tests.html" class="nav-list-link">Running API and UI tests</a></li><li class="nav-list-item"><a href="/yoda/development/yodadrive-development-environment.html" class="nav-list-link">Setting up YodaDrive development environment</a></li><li class="nav-list-item"><a href="/yoda/development/mock_tape_archive.html" class="nav-list-link">Mock tape archive</a></li><li class="nav-list-item"><a href="/yoda/development/development-tips.html" class="nav-list-link">Development tips</a></li><li class="nav-list-item"><a href="/yoda/development/wall-of-fame.html" class="nav-list-link">Wall of Fame</a></li><li class="nav-list-item"><a href="/yoda/development/running-unit-integration-tests.html" class="nav-list-link">Running unit and integration tests</a></li><li class="nav-list-item"><a href="/yoda/development/overview-repositories.html" class="nav-list-link">Overview of repositories</a></li></ul></li></ul>

  
</nav>


  
  
    <footer class="site-footer">&copy; 2017-2024 <a href="https://www.uu.nl/" title="Utrecht University website">Utrecht University</a></footer>

  
</div>

  
  <div class="main" id="top">
    <div id="main-header" class="main-header">
  
    

<div class="search" role="search">
  <div class="search-input-wrap">
    <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Yoda" aria-label="Search Yoda" autocomplete="off">
    <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
  </div>
  <div id="search-results" class="search-results"></div>
</div>

  
  
  
    <nav aria-label="Auxiliary" class="aux-nav">
  <ul class="aux-nav-list">
    
      <li class="aux-nav-list-item">
        <a href="https://github.com/UtrechtUniversity/yoda" class="site-button"
          
        >
          Yoda on GitHub
        </a>
      </li>
    
  </ul>
</nav>

  
</div>

    <div class="main-content-wrap">
      <nav aria-label="Breadcrumb" class="breadcrumb-nav">
  <ol class="breadcrumb-nav-list">
    <li class="breadcrumb-nav-list-item"><a href="/yoda/administration/">Administration Tasks</a></li>
    <li class="breadcrumb-nav-list-item"><span>Upgrading PostgreSQL</span></li>
  </ol>
</nav>
      <div id="main-content" class="main-content">
        <main>
          
            <h1 id="upgrading-postgresql">
  
  
    <a href="#upgrading-postgresql" class="anchor-heading" aria-labelledby="upgrading-postgresql"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Upgrading PostgreSQL
  
  
</h1>
    

<p>This page has information about how to upgrade the PostgreSQL database in Yoda to a newer version.</p>
<h2 id="background">
  
  
    <a href="#background" class="anchor-heading" aria-labelledby="background"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Background
  
  
</h2>
    

<p>Yoda uses PostgreSQL, an open source relational database system, as the iRODS internal database (iCAT database),
and for storing External User Service (EUS) data.</p>

<p>Yoda versions up to and including 1.8.6 work with PostgreSQL 9.2. Yoda 1.8.7 and later 1.8.x versions work with PostgreSQL
9.2 by default, with an optional upgrade to PostgreSQL 15. Yoda 1.9 uses PostgreSQL 15 by default. Although Yoda 1.9
should work with PostgreSQL 9.2, it is recommended to upgrade to PostgreSQL 15 either before/during the upgrade to Yoda 1.9, or
immediately afterwards.</p>
<h2 id="upgrade-methods">
  
  
    <a href="#upgrade-methods" class="anchor-heading" aria-labelledby="upgrade-methods"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Upgrade methods
  
  
</h2>
    

<p>Existing Yoda environments can be upgraded to PostgreSQL 15 by either starting the upgrade from Ansible, or by dumping and restoring
the database manually onto a new server.</p>

<p>Regardless of which method you choose, the following advice applies:</p>
<ul>
  <li>Ensure that that you have a recent database backup before starting the upgrade process.</li>
  <li>First perform the upgrade process on an (acceptance) test environment that resembles your production
environments. This also helps with estimating how much time and diskspace you will need for upgrading the
production environment.</li>
  <li>A database upgrade is a good opportunity to review the Yoda <a href="/yoda/administration/configuring-yoda.html">configuration parameters</a> for
PostgreSQL, and to see if any improvements can be made in areas such as performance tuning.</li>
</ul>
<h2 id="upgrading-the-database-using-ansible">
  
  
    <a href="#upgrading-the-database-using-ansible" class="anchor-heading" aria-labelledby="upgrading-the-database-using-ansible"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Upgrading the database using Ansible
  
  
</h2>
    

<p>The Ansible playbook contains an option for upgrading the database automatically. Note that upgrading the database may
take a significant time on large environments.</p>

<p>In Yoda 1.8.7 and later 1.8.x versions, use the following configuration parameters:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">enable_pgbouncer</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">postgresql_use_native_packages</span><span class="pi">:</span> <span class="no">false</span>
<span class="na">pgsql_version</span><span class="pi">:</span> <span class="m">15</span>

<span class="na">postgresql_perform_db_upgrade</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">postgresql_remove_old_data_after_upgrade</span><span class="pi">:</span> <span class="no">false</span>
</code></pre></div></div>

<p>In Yoda 1.9.x, use just the following configuration parameters:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">postgresql_perform_db_upgrade</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">postgresql_remove_old_data_after_upgrade</span><span class="pi">:</span> <span class="no">false</span>
</code></pre></div></div>
<h2 id="upgrading-and-migrating-the-database-manually">
  
  
    <a href="#upgrading-and-migrating-the-database-manually" class="anchor-heading" aria-labelledby="upgrading-and-migrating-the-database-manually"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Upgrading (and migrating) the database manually
  
  
</h2>
    

<p>It is also possible to manually upgrade the database. This can be useful if you want to, for example,
combine the database upgrade with a migration to a new server.</p>

<p>The steps are:</p>
<ol>
  <li>Deploy a new database server using Ansible. You can do this by adding the server that is to be the new
database server to the database group in Ansible. Donâ€™t remove the current database server yet. If the
environment is not yet on Yoda 1.9.x, you will have to set the database version explicitly in the <code class="language-plaintext highlighter-rouge">host_vars</code>
of the new database server (not the <code class="language-plaintext highlighter-rouge">group_vars</code>), like so:</li>
</ol>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">enable_pgbouncer</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">postgresql_use_native_packages</span><span class="pi">:</span> <span class="no">false</span>
<span class="na">pgsql_version</span><span class="pi">:</span> <span class="m">15</span>
</code></pre></div></div>

<p>Ensure that locale settings for the old and new database server are identical, and that basic performance
   tuning has been configured (e.g. setting <code class="language-plaintext highlighter-rouge">effective_cache_size</code>).</p>

<ol>
  <li>
    <p>Verify that locale of the old and new database are identical, using the <code class="language-plaintext highlighter-rouge">\l</code> command in <code class="language-plaintext highlighter-rouge">psql</code>.</p>
  </li>
  <li>
    <p>Disable iRODS on the consumer (<code class="language-plaintext highlighter-rouge">sudo systemctl stop irods</code>), disable DavRODS and the portal on the portal/DavRODS/combi servers
(<code class="language-plaintext highlighter-rouge">sudo systemctl stop httpd</code>) and disable iRODS on the provider (<code class="language-plaintext highlighter-rouge">sudo systemctl stop irods</code>).</p>
  </li>
  <li>
    <p>Dump the present ICAT database on the old database server (you may want to do this in a tmux session on large environments). For example:</p>
  </li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo -iu postgres pg_dump ICAT | gzip | sudo tee /var/dbbackup/icat-migration.sql.gz &gt; /dev/null
</code></pre></div></div>

<ol>
  <li>
    <p>Transfer the dump file to the new database server.</p>
  </li>
  <li>
    <p>Load the dump file on the new database server:</p>
  </li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo gunzip -c /var/dbbackup/icat-migration.sql.gz | sudo -iu postgres psql ICAT
</code></pre></div></div>

<ol>
  <li>Disable the old database:</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo systemctl stop postgresql
sudo systemctl disable postgresql
</code></pre></div></div>

<ol>
  <li>
    <p>Move the new database configuration to the <code class="language-plaintext highlighter-rouge">group_vars</code>, and remove the old database server from the database group. It is
generally also recommended to enable Yoda-specific database indexes at this point (<code class="language-plaintext highlighter-rouge">irods_database_enable_yoda_indexes: true</code>),
unless there is a specific reason not to use them on the environment. Adjust <code class="language-plaintext highlighter-rouge">irods_database_fqdn</code> to point to the new
database server.</p>
  </li>
  <li>
    <p>Adjust the <code class="language-plaintext highlighter-rouge">/etc/irods/server_config.json</code> Postgres database plugin configuration by setting <code class="language-plaintext highlighter-rouge">db_host</code> and <code class="language-plaintext highlighter-rouge">db_port</code> to the values
for the new database server. The port is typically 6432 if PgBouncer is enabled, otherwise 5432.</p>
  </li>
  <li>
    <p>Restart iRODS.</p>
  </li>
  <li>
    <p>Run the Ansible playbook. You should now have an environment where the new database server has been deployed, iRODS should now talk
to the new database server. Verify that basic functionality of iRODS works (e.g. by examining the output of the <code class="language-plaintext highlighter-rouge">ils</code> command) and
check that iRODS is talking to the new database server (e.g. by viewing the number of transactions in the pgbouncer log file on the
new database server). Disregard any PostgreSQL warning messages in the logs at this step.</p>
  </li>
  <li>
    <p>Check the database plugin configuration in the <code class="language-plaintext highlighter-rouge">/etc/irods/server_config.json</code> configuration file. Ensure that <code class="language-plaintext highlighter-rouge">db_odbc_driver</code> is
set to <code class="language-plaintext highlighter-rouge">"PostgreSQL"</code>. If the database plugin still has a <code class="language-plaintext highlighter-rouge">db_odbc_type</code> parameter, remove it. Restart iRODS if any manual changes
were needed in this step.</p>
  </li>
  <li>
    <p>Verify that Yoda works as expected.</p>
  </li>
  <li>
    <p>Remember to update database backup and monitoring scripts so that they point to the new database.</p>
  </li>
</ol>

          

          
        </main>
        

  <hr>
  <footer>
    

    <p class="text-small text-grey-dk-100 mb-0">Licensed under <a href="https://github.com/UtrechtUniversity/yoda/blob/development/LICENSE">GPLv3</a>.</p>

    
      <div class="d-flex mt-2">
        
        
          <p class="text-small text-grey-dk-000 mb-0">
            <a href="https://github.com/UtrechtUniversity/yoda/tree/development/docs/administration/upgrading-postgresql.md" id="edit-this-page">Edit this page on GitHub.</a>
          </p>
        
      </div>
    
  </footer>


      </div>
    </div>
    
      

<div class="search-overlay"></div>

    
  </div>

  
</body>
</html>

